qt_add_executable(DameGameBoy
    main.cpp
)

set(CMAKE_AUTOUIC ON)
set(CMAKE_AUTOMOC ON)

set(MOC_SOURCES
    hw/cartridge.hh
    hw/cpu.hh
    hw/gameboy.hh
    hw/memory_bank_controller.hh
    hw/ram.hh
    hw/rom.hh
)

# Pull app version from CMakeLists
configure_file(config.h.in config.h)
target_include_directories(DameGameBoy PUBLIC "${PROJECT_BINARY_DIR}/src")

# Enable QTP0004 to suppress warning generated by qt_add_qml_module
if(QT_KNOWN_POLICY_QTP0004)
    qt_policy(SET QTP0004 NEW)
endif()

qt_add_qml_module(DameGameBoy
    URI DameGameBoy
    VERSION ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}
    QML_FILES
        ui/Main.qml
    SOURCES
        config.h.in
        hw/cartridge.cpp
        hw/cartridge.hh
        hw/cpu.cpp
        hw/cpu.hh
        hw/gameboy.cpp
        hw/gameboy.hh
        hw/memory_bank_controller.cpp
        hw/memory_bank_controller.hh
        hw/ram.cpp
        hw/ram.hh
        hw/rom.cpp
        hw/rom.hh
)

message(INCLUDES="${INCLUDES}")

# Qt for iOS sets MACOSX_BUNDLE_GUI_IDENTIFIER automatically since Qt 6.1.
# If you are developing for iOS or macOS you should consider setting an
# explicit, fixed bundle identifier manually though.
set_target_properties(DameGameBoy PROPERTIES
    MACOSX_BUNDLE_GUI_IDENTIFIER com.rekolae.DameGameBoy
    MACOSX_BUNDLE_BUNDLE_VERSION ${PROJECT_VERSION}
    MACOSX_BUNDLE_SHORT_VERSION_STRING ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}
    MACOSX_BUNDLE TRUE
    WIN32_EXECUTABLE TRUE
)

target_link_libraries(DameGameBoy
    PRIVATE Qt6::Quick Qt6::Core Qt6::Gui
)

include(GNUInstallDirs)
install(TARGETS DameGameBoy
    BUNDLE DESTINATION .
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)
